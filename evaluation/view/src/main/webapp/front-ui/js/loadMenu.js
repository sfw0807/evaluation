(function(){$.menu={openWindow:function(A){window.open(A)},loadUrl:function(A,B){if(A==""||($(".datagrid-mask-side").size()>0&&A.indexOf("?tmp=")<0)){return}$("#hidMainMenuUrl").val($.base64_encode(A));if(B==null){$("#mainMenuContainer a").each(function(D,C){if(C.outerHTML.indexOf("'"+A+"'")>0){$(C).parents(".collapse").eq(0).collapse("show");B=C}})}if(B!=null){$("#hidMainFunctionID").val($(B).nextAll("input[name=FunctionID]").eq(0).val());$("#hidMainMenuID").val($(B).nextAll("input[name=ID]").eq(0).val())}$(".menuFirst,.menuSecond,menuThird").removeClass("menuActive");$("#mainMenuContainer").find("input[name=ID]").each(function(E,D){var F=$.base64_decode($("#hidMainMenuID").val());var C=$.base64_decode($(D).val());if(F==C){$(D).parents(".menuFirst,.menuSecond,menuThird").eq(0).addClass(" menuActive")}});$("#mainFrameContainer").find("div").eq(0).ajaxDialogLoading();$("<div></div>").load(A,function(C){if(C.indexOf("<span>登录</span>")!=-1){alert("登录已经超时，请重新登录");window.location=$.rootURL}else{$("#mainFrameContainer").html(C);$("html").animate({scrollTop:0},1);setTimeout($.SEM.doResize,300);$("input[type=text]").each(function(E,D){$(D).bind("keypress",function(F){if(F.keyCode==13){return false}})})}})},cacheMenu:function(){$(".collapse").on("show.bs.collapse",function(){var B=this.id;var A=$(this).prev().attr("class");$(".collapse").each(function(D,C){if(A=="menuFirst"&&B!=C.id){$(C).collapse("hide")}})}).on("shown.bs.collapse",function(){$("#hidMainMenu").val($.base64_encode($("#mainMenuContainer").html()))}).on("hidden.bs.collapse",function(){$("#hidMainMenu").val($.base64_encode($("#mainMenuContainer").html()))})},loadMainMenuData:function(){var B="",A=1;$.getServerJson("api/EduMenuAPI/GetMainMenuList",null,function(C){var D=0;$.each(C,function(I,G){if(G.RelationID!=""){var J="";if(D==0){J=" in"}var F="";if(G.MenuName=="首页"){$("#hidMainMenuUrl").val($.base64_encode(G.FunctionScript));$("#hidMainFunctionID").val($.base64_encode(G.FunctionID));$("#hidMainMenuID").val($.base64_encode(G.ID))}if(G.FunctionScript!=""){F=" onclick=\"$.menu.loadUrl('"+G.FunctionScript+"',this)\""}var E="collapse_"+A+"_"+I;var H="menuFirst";B+='<div class="'+H+'" '+F+">";B+='<a data-toggle="collapse" href="#'+E+'">';B+=G.MenuName;B+="</a>";B+="</div>";if(G.childMenuList.length>0){B+='<div id="'+E+'" class="accordion-body collapse '+J+'">';B+=$.menu.bindMainMenuData(G.childMenuList,A);B+="</div>"}D++}});$("#mainMenuContainer").html(B);$("#hidMainMenu").val($.base64_encode(B));$.menu.loadUrl($.base64_decode($("#hidMainMenuUrl").val()));$.menu.cacheMenu()})},bindMainMenuData:function(C,A){A++;var B="";var D="";switch(A){case 2:D="menuSecond";break;case 3:D="menuThird";break}$.each(C,function(G,F){if(F.RelationID!=""){var H="";var E="collapse_"+A+"_"+G;if(F.FunctionScript!=null){if($("#hidMainMenuUrl").val()==""){$("#hidMainMenuUrl").val($.base64_encode(F.FunctionScript));$("#hidMainFunctionID").val($.base64_encode(F.FunctionID));$("#hidMainMenuID").val($.base64_encode(F.ID))}H="onclick=\"$.menu.loadUrl('"+F.FunctionScript+"',this)\""}B+='<div class="'+D+'">';if(F.childMenuList.length>0){B+='<div class="menubarMain">';H=' data-toggle="collapse" href="#'+E+'"'}else{if(A==2){B+='<div class="menubar">'}else{B+="<div>"}}B+="<a "+H+" >";B+=F.MenuName;B+="</a>";B+='<input name="FunctionID" type="hidden" value="'+$.base64_encode(F.FunctionID)+'"/>';B+='<input name="ID" type="hidden" value="'+$.base64_encode(F.ID)+'"/>';B+="</div></div>";if(F.childMenuList.length>0){B+='<div id="'+E+'" class="accordion-body collapse">';B+=$.menu.bindMainMenuData(F.childMenuList,A);B+="</div>"}}});return B}}})();