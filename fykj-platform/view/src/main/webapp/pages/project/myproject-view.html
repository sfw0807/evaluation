<namespace id="myproject-view">
    <ol class="breadcrumb">
        <li><a href="#">我的项目</a></li>
        <li><a href="#">项目明细</a></li>
    </ol>
    <div class="box box-info">
    	<div class="panel panel-default" style="margin-bottom: 0px; border: none;">
    		<div class="panel-heading">
    			<h3 class="panel-title">项目基本信息</h3>
    			<div class="btn-group pull-right" style="margin-top: -25px;">
                    <a class="btn btn-sm btn-default" id="btnCancel">
                        <i class="fa fa-align-justify"> 返回</i>
                    </a>
                </div>
    		</div>
    		<div class="panel-body">
    			<form class="form-horizontal">
    				<div class="row">
    					<div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">项目编号</label>
                                <div class="col-sm-9">
                                    <input name="projectCode" disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.projectCode}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">项目名称</label>
                                <div class="col-sm-9">
                                    <input name="projectName"  disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.projectName}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">项目类型</label>
                                <div class="col-sm-9">
                                    <input name="projectType" disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.projectTypeString}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">客户名称</label>
                                <div class="col-sm-9">
                                	<input name="customer"  disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.customer}">
                                </div>
                            </div>
                        </div>
    				</div>
    				
    				<div class="row">
    					<div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">合同编号</label>
                                <div class="col-sm-9">
                                	<input name="customer"  disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.contractCode}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">签订日期</label>
                                <div class="col-sm-9">
                                	<input name="customer"  disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.contractDate}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">开始日期</label>
                                <div class="col-sm-9">
                                	<input name="customer"  disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.beginDate}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm">结束日期</label>
                                <div class="col-sm-9">
                                	<input name="customer"  disabled="disabled" type="text" class="form-control input-sm" placeholder="" th:value="${myproject.endDate}">
                                </div>
                            </div>
                        </div>
    				</div>
    				<div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm" style="color: red;">合同金额</label>
                                <div class="col-sm-9">
                                    <span id="projectAmt" style="color: red; font-weight:bold;"  class="form-control label-form-control" th:text="${myproject.projectAmt}"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm" style="color: red;">人力成本</label>
                                <div class="col-sm-9">
                                    <span id="resourceCost" style="color: red; font-weight:bold;"  class="form-control label-form-control"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm" style="color: red;">其他支出</label>
                                <div class="col-sm-9">
                                    <span id="expenseCost" style="color: red; font-weight:bold;"  class="form-control label-form-control"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-3 control-label input-sm" style="color: red;">人力占比</label>
                                <div class="col-sm-9">
                                    <span id="resourceProp" style="color: red; font-weight:bold;"  class="form-control label-form-control"></span>
                                </div>
                            </div>
                        </div>
                    </div>
    				<input type="hidden" id="projectId" name="projectId" th:value="${myproject.id}" style="width: 100%" />
    			</form>
    		</div>
    	</div>
    	<div class="panel panel-default" style="margin-top:-20px; margin-bottom: 0px; border: none;">
    		<div class="panel-heading">
	    		<h3 class="panel-title">人力资源信息</h3>
    		</div>
    		<div class="panel-body">
    			<table id="resourceListTable" class="table dataTable row-border cell-border " cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>职位</th>
                        <th>姓名</th>
                        <th>使用率</th>
                        <th>预计开始</th>
                        <th>预计结束</th>
                        <th>实际开始</th>
                        <th>实际结束</th>
                        <th>成本</th>
                        <th>状态</th>
                    </tr>
                    </thead>
                </table>
    		</div>
    	</div>
    	<div class="panel panel-default" style="margin-bottom: 0px; border: none;">
    		<div class="panel-heading">
                <h3 class="panel-title">收入信息维护</h3>
            </div>
            <div class="panel-body">
            	<table id="inComeListTable" class="table dataTable row-border cell-border " cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>年月</th>
                        <th>费用</th>
                        <th>描述</th>
                    </tr>
                    </thead>
                </table>
            </div>
    	</div>
    	<div class="panel panel-default" style="margin-bottom: 0px; border: none;">
    		<div class="panel-heading">
                <h3 class="panel-title">支出信息维护</h3>
            </div>
            <div class="panel-body">
            	<table id="expenseListTable" class="table dataTable row-border cell-border " cellspacing="0" width="100%">
                    <thead>
                    <tr>
                        <th>年月</th>
                        <th>费用</th>
                        <th>描述</th>
                    </tr>
                    </thead>
                </table>
            </div>
    	</div>
    	<div id="approveDiv" class="panel panel-default" style="margin-bottom: 0px; border:none;">
    		<div class="panel-heading">
                <h3 class="panel-title">项目审批信息</h3>
            </div>
            <div class="panel-body">
            	<form id="approveForm" class="form-horizontal">
            		<div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-1 control-label input-sm" style="text-align:center;">送审备注</label>
                                <div class="col-sm-11">
                                    <textarea rows="4" class="form-control input-sm" th:text="${myproject.remark}"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-1 control-label input-sm" style="text-align:center;">审批意见</label>
                                <div class="col-sm-11">
                                    <textarea disabled="disabled" rows="4" class="form-control input-sm" th:text="${myproject.approveRemark}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="flowVersion" name="flowVersion" th:value="${myproject.flowVersion}" style="width: 100%" />
            	</form>
            </div>
    	</div>
    </div>
</namespace>

<script type="text/javascript">
	$(function() {
		var page = {
			namespace : $('#myproject-view').namespace(),
			init : function() {
				page.getProjectCost();
				
				if($("#flowVersion").val() == "v1.0") {
					$("#approveDiv").hide();
				}
			},
			getProjectCost : function() {
				var opt = {
					endpoint : "/pms/project/getProjectCost",
					data : {
						'id' : $("#projectId").val()
					},
					success : function(data) {
						$("#resourceCost").html(data.resourceCost);
						$("#expenseCost").html(data.expenseCost);
						$("#resourceProp").html(data.resourceProp);
						
						page.format();
					}
				};

				page.namespace.getRequest(opt);
			},
			format : function() {
				$("#projectAmt").formatCurrency();
				$("#expenseCost").formatCurrency();
				$("#resourceCost").formatCurrency();
			},
			doCancel : function() {
				page.namespace.skiphtml("/pms/project/toMyProjectList");
			}
		}
		
		page.init();
		
		// 项目资源列表
		page.resourceListTable = $('#resourceListTable').initDataTable({
            url : "/pms/project/getMyProjectResource",
            urlDataFn : function() {
                return {id:$("#projectId").val()};
            },
            paging: false,
            checkbox : false,
            columns : [
                {"data" : "titleString", "width" : "10%"}, 
                {"data" : "resourceName", "width" : "10%"},
                {"data" : "modulus", "width" : "10%"},
                {"data" : "estBeginDate", "width" : "10%"}, 
                {"data" : "estEndDate", "width" : "10%"},
                {"data" : "relBeginDate", "width" : "10%"}, 
                {"data" : "relEndDate", "width" : "10%"},
                {"data" : "cost", "with" : "10%"},
                {
                    "data" : "status",
                    "width" : "10%",
                    "render" : function(data, type, row, meta) {
                        if(data == 'projecting') {
                            return '<label class="label label-danger">'+ row.statusString+'</label>';
                        }else if(data == 'processing'){
                            return '<label class="label label-info">'+ row.statusString+'</label>';
                        }else{
                            return '<label class="label label-primary">'+ row.statusString+'</label>';
                        }
                    }
                }
            ]
        });
		
		// 项目收入列表
		page.inComeListTable = $('#inComeListTable').initDataTable({
            url : "/pms/project/getMyProjectIncome",
            urlDataFn : function() {
                return {id:$("#projectId").val()};
            },
            paging: false,
            checkbox : false,
            columns : [
                {"data" : "inComeDate", "width" : "20%"}, 
                {"data" : "inComeAmt", "width" : "20%"},
                {"data" : "description", "width" : "20%"}
            ]
        });
		
		// 项目支出列表
		page.expenseListTable = $('#expenseListTable').initDataTable({
            url : "/pms/project/getMyProjectExpense",
            urlDataFn : function() {
                return {id:$("#projectId").val()};
            },
            paging: false,
            checkbox : false,
            columns : [
                {"data" : "expenseDate", "width" : "20%"}, 
                {"data" : "expenseAmt", "width" : "20%"},
                {"data" : "description", "width" : "20%"}
            ]
        });
		
		page.namespace.root.find("#btnCancel").on('click', page.doCancel);
	});
</script>